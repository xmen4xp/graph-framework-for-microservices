version: "3.9"
services:
  etcd:
    image: quay.io/coreos/etcd:v3.5.10
    restart: "always"
    network_mode: host
    environment:
      ALLOW_NONE_AUTHENTICATION: 'yes'
      ETCD_AUTH_TOKEN: 'simple'
  kube-apiserver:
    container_name: kube-apiserver
    image: registry.k8s.io/kube-apiserver:v1.29.0
    command: kube-apiserver --etcd-servers http://localhost:2379 --service-account-key-file=/custom/k8s/certs/sa.pub --service-account-signing-key-file=/custom/k8s/certs/sa.key --service-account-issuer=api --tls-cert-file=/custom/k8s/certs/apiserver.crt --tls-private-key-file=/custom/k8s/certs/apiserver.key --client-ca-file=/custom/k8s/certs/ca.crt  --service-cluster-ip-range=10.24.0.0/16
    volumes:
      - ./certs:/custom/k8s/certs
    network_mode: host
  nexus-k8s-proxy:
    container_name: nexus-k8s-proxy
    image: bitnami/kubectl
    command: proxy --disable-filter=true --v=9 --kubeconfig /var/lib/k0s/pki/kubeconfig -p $KUBECTL_PROXY_PORT
    hostname: k8s-proxy
    privileged: true
    network_mode: "host"
    volumes:
      - .:/var/lib/k0s/pki

